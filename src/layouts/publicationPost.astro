---
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import FormattedDate from "@/components/FormattedDate.astro";

type CoAuthor = { name: string; scholar: string };

type Props = {
  title: string;
  venue: string;
  shortVenue?: string;
  venueUrl?: string;   
  pubDate: Date;
  abstract?: string;
  keywords?: string[];
  heroImage?: string;
  pdf?: string;
  doi?: string;
  coAuthors?: CoAuthor[];
};

const {
  title,
  venue,
  shortVenue,
  venueUrl,    
  pubDate,
  abstract,
  keywords,
  heroImage,
  pdf,
  doi,
  coAuthors,
} = Astro.props as Props;

const doiUrl = doi ? `https://doi.org/${doi}` : null;
const venueLine = shortVenue ? venue : venue;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={abstract ?? venueLine} />
  </head>
  <body>
    <Header />

    <main class="container mx-auto md:px-10 px-4 py-12 max-w-[940px]">
      <a href="/publications/" class="underline underline-offset-4">
        ← All Publications
      </a>

     {heroImage && (
  <div class="mt-6 rounded-3xl border-1 border-black shadow-card overflow-hidden">
    <img
      src={heroImage}
      alt={`${title} — cover image`}
      class="w-full h-auto object-contain"
      loading="eager"
    />
  </div>
)}

      {/* Title + meta */}
      <h1 class="mt-8 text-4xl md:text-5xl font-bold leading-tight">{title}</h1>

      <div class="mt-4 text-sm font-medium">
  {venue}
  {shortVenue && (
    <>
      {" ("}
      {venueUrl ? (
        <a
          href={venueUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="underline underline-offset-4 hover:opacity-100"
        >
          {shortVenue}
        </a>
      ) : (
        shortVenue
      )}
      {")"}
    </>
  )}
</div>

{/* Date on its own line, subtle + tight spacing */}
<div class="mt-1 text-sm font-light opacity-70">
  <FormattedDate date={pubDate} />
</div>



      {/* Authors */}
      {coAuthors && coAuthors.length > 0 && (
        <p class="mt-4 text-sm opacity-80">
          <span class="font-medium">Authors:</span>{" "}
          {coAuthors.map((a, i) => (
            <>
              <a
                href={a.scholar}
                target="_blank"
                rel="noopener noreferrer"
                class="underline underline-offset-4 hover:text-ppink transition"
              >
                {a.name}
              </a>
              {i < coAuthors.length - 1 ? ", " : ""}
            </>
          ))}
        </p>
      )}

      

      {/* Keywords */}
      {keywords && keywords.length > 0 && (
        <div class="mt-6 flex flex-wrap gap-2 text-sm">
          {keywords.map((k) => (
            <span class="border border-black rounded-full px-3 py-1">
              {k}
            </span>
          ))}
        </div>
      )}

      {/* Links */}
      {(pdf || doiUrl) && (
        <div class="mt-6 flex flex-wrap gap-3 text-sm">
          {pdf && (
            <a
              class="px-5 py-3 border-1 border-black rounded-lg shadow-card hover:shadow-hover transition whitespace-nowrap bg-pyellow"
              href={pdf}
              target="_blank"
              rel="noopener noreferrer"
            >
              PDF
            </a>
          )}
          {doiUrl && (
            <a
              class="px-5 py-3 border-1 border-black rounded-lg shadow-card hover:shadow-hover transition whitespace-nowrap bg-pgreen"
              href={doiUrl}
              target="_blank"
              rel="noopener noreferrer"
            >
              DOI
            </a>
          )}
          
        </div>
      )}

      
      {abstract && (
        <section class="mt-10 text-left">
          <h2 class="text-xl font-semibold">Abstract</h2>
          <p class="mt-3 opacity-85 leading-relaxed">{abstract}</p>
        </section>
      )}

      {/* MDX body (optional: can be empty or contain extra info) */}
      <article class="prose mt-10 max-w-none">
        <slot />
      </article>
    </main>

    <Footer />
  </body>
</html>
